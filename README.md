# 硬盘保活工具

一个现代化的Windows桌面工具，基于PyQt5构建，用于定期读取硬盘文件，防止外置硬盘或网络硬盘因长时间不活动而自动休眠或断开连接。

## 功能特点

### 🚀 核心功能

**定时读取** - 按照设定的时间间隔自动读取目标文件，保持硬盘活跃状态

**实时监控** - 界面实时显示：
  - 当前运行状态（带彩色指示灯）
  - 已读取次数
  - 累计运行时间
  - 下次读取倒计时
  - 最后读取时间

**灵活配置**
  - 自定义读取间隔（秒）
  - 可设置总运行时间（0为无限运行）
  - 支持随时开始/停止

### ✨ 界面特性

**现代化设计** - 基于PyQt5的Material Design风格界面
  - 简洁优雅的布局
  - 流畅的视觉反馈
  - 自定义QSS样式表

**系统托盘** - 支持最小化到系统托盘
  - 后台运行不占用任务栏
  - 托盘菜单快速访问
  - 运行状态实时提示

**高DPI支持** - 完美适配高分辨率显示器，界面清晰锐利

## 系统要求

- **操作系统**：Windows 7 及以上版本
- **Python版本**：Python 3.6+
- **依赖库**：PyQt5 5.15.0+

## 安装说明

### 方法一：直接使用exe文件（推荐给普通用户）

如果已经有打包好的 `硬盘保活工具.exe`，直接双击运行即可，**无需安装Python和任何依赖**。

### 方法二：从源码运行（开发者/进阶用户）

#### 步骤1：确认Python环境

确保已安装Python 3.6或更高版本：

```bash
# 检查Python版本
python --version

# 如果未安装，请从官网下载：https://www.python.org/downloads/
# 安装时务必勾选 "Add Python to PATH"
```

#### 步骤2：安装PyQt5依赖

**选项A：使用requirements.txt（推荐）**

```bash
# 在项目目录下打开终端，运行：
pip install -r requirements.txt
```

**选项B：直接安装PyQt5**

```bash
# 安装最新版本的PyQt5
pip install PyQt5

# 或指定版本
pip install PyQt5>=5.15.0
```

**选项C：使用国内镜像加速（如遇下载慢）**

```bash
# 使用清华镜像源
pip install -i https://pypi.tuna.tsinghua.edu.cn/simple PyQt5

# 或使用阿里镜像源
pip install -i https://mirrors.aliyun.com/pypi/simple/ PyQt5
```

#### 步骤3：验证安装

```bash
# 验证PyQt5是否安装成功
python -c "import PyQt5; print('PyQt5安装成功！')"
```

#### 常见安装问题

**问题1：pip不是内部或外部命令**
- 解决：确保Python安装时勾选了"Add Python to PATH"
- 或手动添加Python路径到系统环境变量

**问题2：安装速度慢或超时**
- 解决：使用国内镜像源（见上方选项C）

**问题3：权限错误**
- 解决：使用管理员权限运行命令提示符
- 或在命令后加 `--user`：`pip install --user PyQt5`

## 使用方法

### 运行程序

**方式一：使用exe文件（推荐）**
- 如果已打包，直接双击 `硬盘保活工具.exe` 即可

**方式二：使用启动脚本**
- 双击 `启动.bat`（会自动检查依赖）

**方式三：使用Python命令**
- 打开终端，运行 `python main.py`

### 使用步骤

1. **选择文件**：
   - 点击"浏览"按钮
   - 选择硬盘上的任意文件（建议选择小文件）
   - 例如：移动硬盘上的某个txt文件

2. **配置参数**：
   - **读取间隔（秒）**：设置每隔多久读取一次文件（默认60秒）
   - **总运行时间（分钟）**：设置运行多久后自动停止（0为无限运行）

3. **开始运行**：
   - 点击"开始运行"按钮
   - 界面会显示运行状态、读取次数、运行时间等信息
   - 状态指示灯变为绿色表示正在运行

4. **后台运行**：
   - 点击窗口关闭按钮，程序会最小化到系统托盘
   - 从托盘图标右键菜单可以重新打开或退出程序

5. **停止运行**：
   - 点击"停止运行"按钮
   - 或等待设定的运行时间结束自动停止

## 使用场景

- 🔌 **外置硬盘**：防止USB移动硬盘自动休眠导致断开连接
- 🌐 **网络存储**：保持NAS或网络共享磁盘的连接状态
- ☁️ **云盘同步**：维持云盘挂载磁盘的活跃状态
- 📂 **数据传输**：长时间传输或操作时防止硬盘休眠
- 💾 **服务器硬盘**：保持远程服务器存储的活跃状态

## 注意事项

- ✅ 建议选择一个小文件，程序只会读取1个字节
- ✅ 本工具对系统性能影响极小（CPU和内存占用可忽略）
- ✅ 设置总运行时间后程序会自动停止
- ✅ 运行中关闭窗口会最小化到托盘，而非退出程序
- ⚠️ 如果启动脚本提示找不到Python，请确保Python已添加到环境变量

## 技术特性

### 架构设计
- **界面框架**：PyQt5 - 现代化跨平台GUI框架
- **样式系统**：QSS - 类似CSS的样式表，支持自定义主题
- **多线程**：工作线程与UI线程分离，界面响应流畅
- **信号机制**：PyQt5信号槽机制，线程安全的UI更新

### 性能优化
- 每次仅读取1字节，对硬盘无负担
- 后台线程运行，不阻塞UI
- 低CPU和内存占用

### 视觉设计
- Material Design设计语言
- 完美的高DPI缩放支持
- 自定义配色方案（可通过styles.qss修改）
- 支持自定义图标（icon.ico或icon.png）

## 目录结构

```
硬盘保活工具/
├── main.py              # 主程序（PyQt5版本）
├── styles.qss           # QSS样式表文件
├── requirements.txt     # Python依赖列表
├── 启动.bat            # 运行程序的启动脚本
├── build.bat           # 打包exe的脚本（可选）
├── icon.ico            # 窗口和托盘图标
├── icon.png            # 备用PNG格式图标
└── README.md           # 项目说明文档（本文件）
```

**打包后会生成：**
```
├── dist/
│   └── 硬盘保活工具.exe  # 打包好的可执行文件
├── build/                 # 临时文件（可删除）
└── 硬盘保活工具.spec      # 打包配置文件（可保留）
```

## 自定义样式

如果您想自定义界面外观，可以编辑 `styles.qss` 文件：

```css
/* 修改主题色示例 */
#startButton {
    background-color: #your-color;  /* 自定义颜色 */
}
```

QSS语法类似CSS，支持颜色、边框、圆角、阴影等样式属性。

## 打包成exe教程

### 为什么要打包成exe？

✅ **一键运行**：无需安装Python环境，双击即用  
✅ **便于分享**：可以分发给没有Python的用户  
✅ **更专业**：像商业软件一样的使用体验  
✅ **完全独立**：所有依赖都打包在一起

### 快速开始（推荐）

**最简单的方法：使用自动打包脚本**

```bash
# 直接双击运行
build.bat
```

这个脚本会：
- ✅ 自动检查并安装PyInstaller
- ✅ 清理旧的打包文件
- ✅ 执行完整的打包过程
- ✅ 在完成后告诉您exe文件的位置

**就这么简单！** 适合不熟悉命令行的用户。

---

### 打包步骤详解（手动方式）

#### 步骤1：安装打包工具

```bash
# 安装PyInstaller
pip install pyinstaller

# 验证安装
python -m PyInstaller --version
```

#### 步骤2：准备打包

确保以下文件在项目目录中：
- ✅ `main.py` - 主程序
- ✅ `styles.qss` - 样式表文件
- ✅ `icon.ico` - 图标文件
- ✅ `icon.png` - 备用图标（可选）

#### 步骤3：执行打包命令

**方案一：单文件模式（推荐）**

生成单个exe文件，便于分发：

```bash
python -m PyInstaller --onefile --windowed --icon=icon.ico --name="硬盘保活工具" --add-data="styles.qss;." --add-data="icon.ico;." --add-data="icon.png;." main.py
```

**方案二：目录模式（启动更快）**

生成文件夹，启动速度更快：

```bash
python -m PyInstaller --windowed --icon=icon.ico --name="硬盘保活工具" --add-data="styles.qss;." --add-data="icon.ico;." --add-data="icon.png;." main.py
```

#### 步骤4：查找打包结果

打包完成后，在项目目录中：

```
硬盘保活工具/
├── dist/
│   └── 硬盘保活工具.exe  ← 这就是最终的exe文件！
├── build/                  ← 临时文件（可删除）
└── 硬盘保活工具.spec       ← 打包配置（可保存用于下次打包）
```

#### 步骤5：测试exe文件

1. 进入 `dist` 目录
2. 双击 `硬盘保活工具.exe`
3. 测试所有功能是否正常

### 打包命令参数说明

| 参数 | 说明 |
|------|------|
| `--onefile` | 打包成单个exe文件 |
| `--windowed` | 无控制台窗口（GUI程序必加） |
| `--icon=icon.ico` | 设置exe图标 |
| `--name="硬盘保活工具"` | 设置exe文件名 |
| `--add-data="文件;."` | 包含额外的资源文件 |

### 高级打包选项

#### 1. 创建打包脚本（推荐）

为了方便重复打包，可以创建 `build.bat` 脚本：

```batch
@echo off
echo ========================================
echo   硬盘保活工具 - 打包脚本
echo ========================================
echo.

echo [1/3] 清理旧的打包文件...
if exist build rmdir /s /q build
if exist dist rmdir /s /q dist
if exist "硬盘保活工具.spec" del "硬盘保活工具.spec"

echo [2/3] 开始打包...
python -m PyInstaller --onefile ^
    --windowed ^
    --icon=icon.ico ^
    --name="硬盘保活工具" ^
    --add-data="styles.qss;." ^
    --add-data="icon.ico;." ^
    --add-data="icon.png;." ^
    main.py

echo [3/3] 打包完成！
echo.
echo 生成的exe文件位置: dist\硬盘保活工具.exe
echo.
pause
```

#### 2. 使用spec文件（高级用户）

第一次打包后会生成 `.spec` 文件，可以编辑它进行高级配置：

```bash
# 使用spec文件打包
python -m PyInstaller 硬盘保活工具.spec
```

#### 3. 添加版本信息（Windows）

创建 `version.txt` 文件添加版本信息：

```
VSVersionInfo(
  ffi=FixedFileInfo(
    filevers=(2, 0, 0, 0),
    prodvers=(2, 0, 0, 0),
    ...
  ),
  ...
)
```

然后在打包命令中添加：`--version-file=version.txt`

### 常见打包问题

#### 问题1：exe运行时提示缺少模块

**原因**：某些动态导入的模块未被打包  
**解决**：在打包命令中添加 `--hidden-import=模块名`

```bash
python -m PyInstaller --onefile --windowed --hidden-import=PyQt5.QtCore --hidden-import=PyQt5.QtWidgets ...
```

#### 问题2：exe体积过大（50MB+）

**原因**：这是正常的，PyQt5包含完整的Qt库  
**优化方案**：
- 使用UPX压缩：`--upx-dir=upx路径`
- 使用目录模式而非单文件模式
- 排除不需要的模块：`--exclude-module=模块名`

#### 问题3：杀毒软件报毒

**原因**：新打包的exe未被杀软识别，属于误报  
**解决**：
- 添加到杀软白名单
- 使用代码签名证书（专业方案）
- 等待几天后杀软数据库更新

#### 问题4：打包后样式文件丢失

**原因**：未使用 `--add-data` 包含样式文件  
**解决**：确保打包命令包含 `--add-data="styles.qss;."`

#### 问题5：打包失败，提示找不到pyinstaller

**解决**：
```bash
# 重新安装pyinstaller
pip uninstall pyinstaller
pip install pyinstaller
```

### 打包后的分发

打包完成后，您可以：

1. **单文件模式**：直接分发 `dist\硬盘保活工具.exe`
2. **目录模式**：将整个 `dist` 文件夹打包成zip分发
3. **制作安装包**：使用Inno Setup或NSIS制作安装程序（高级）

### 打包前的优化建议

1. ✅ 测试所有功能在源码中正常工作
2. ✅ 确保图标和资源文件路径正确
3. ✅ 移除调试代码和打印语句
4. ✅ 更新版本号和文档
5. ✅ 在干净的环境中测试打包后的exe

### 打包性能对比

| 打包模式 | 体积 | 启动速度 | 分发便利性 | 推荐场景 |
|---------|------|---------|-----------|---------|
| 单文件（--onefile） | ~50MB | 中等 | ⭐⭐⭐⭐⭐ | 分发给他人 |
| 目录模式 | ~45MB | 快 | ⭐⭐⭐ | 个人使用 |
| 源码运行 | <1MB | 慢 | ⭐⭐ | 开发调试 |

## 许可证

本项目采用自由使用许可，可自由使用、修改和分发。

## 更新日志

### v2.0 (2025-11-02)
- 🎨 **重大更新**：使用PyQt5重构，全新现代化界面
- ✨ 新增系统托盘支持，可后台运行
- 🎯 Material Design风格设计
- 💅 QSS样式表系统，支持自定义主题
- 🚀 更流畅的界面响应和状态更新
- 🔧 改进的高DPI支持
- 📝 更详细的状态指示（彩色状态灯）
- 🎭 优化的视觉反馈和用户体验

### v1.0 (2025-10-31)
- 首次发布（Tkinter版本）
- 支持定时读取文件保持硬盘活跃
- 实时状态监控（读取次数、运行时间、倒计时等）
- 高DPI界面支持
- 可调整窗口大小
- 支持自定义图标
- 提供启动.bat脚本一键启动

